<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ABC Corp — Proposals</title>
  <style>
    :root{--accent:#0b66ff;--muted:#666;--bg:#f7f9fc}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.5;margin:0;background:var(--bg);color:#111}
    header{background:#fff;padding:1rem 1.25rem;border-bottom:1px solid #e6e9ef}
    header h1{margin:0;font-size:1.125rem}
    .container{display:flex;gap:1rem;padding:1rem}
    #sidebar{width:320px;max-width:40%;min-width:220px}
    #sidebar input{width:100%;padding:.5rem;border:1px solid #d7dce7;border-radius:6px;margin-bottom:.5rem}
    #proposals{list-style:none;padding:0;margin:0;border:1px solid #e6e9ef;background:#fff;border-radius:6px;max-height:65vh;overflow:auto}
    #proposals li{padding:.75rem .85rem;border-bottom:1px solid #f1f3f6;cursor:pointer}
    #proposals li:last-child{border-bottom:0}
    #proposals li:hover{background:#fbfdff}
    #proposals li .meta{font-size:.875rem;color:var(--muted)}
    #viewer{flex:1;background:#fff;border-radius:6px;padding:1rem;border:1px solid #e6e9ef;max-height:75vh;overflow:auto}
    #viewer .toolbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
    #viewer .toolbar a{color:var(--accent);text-decoration:none}
    pre{background:#0b1220;color:#e6eef8;padding:1rem;border-radius:6px;overflow:auto}
    @media (max-width:800px){.container{flex-direction:column}#sidebar{width:100%;max-width:none}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h1>ABC Corp — Proposals</h1>
        <p style="margin:0;color:var(--muted);font-size:.95rem">Browse, preview, and download proposals published by ABC Corp.</p>
      </div>
      <div>
        <a href="upload.html" style="background:var(--accent);color:#fff;padding:0.45rem 0.75rem;border-radius:6px;text-decoration:none;font-weight:600">Upload Proposal</a>
      </div>
    </div>
    <!-- <p style="margin:0;color:var(--muted);font-size:.95rem">Browse, preview, and download proposals published by ABC Corp.</p>
-->
  </header>

  <div class="container">
    <aside id="sidebar">
      <input id="search" placeholder="Filter proposals..." aria-label="Filter proposals" />
      <ul id="proposals" aria-live="polite">
        <!-- Filled by script -->
      </ul>
    </aside>

    <section id="viewer">
      <div class="toolbar">
        <div id="currentTitle">Select a proposal</div>
        <div>
          <a id="downloadLink" href="#" download style="display:none">Download .md</a>
        </div>
      </div>
      <article id="content">
        <p style="color:var(--muted)">Choose a proposal from the list to preview its contents.</p>
      </article>
    </section>
  </div>

  <footer style="padding:1rem;color:var(--muted);font-size:.9rem">Sample site for ABC Corp proposals. Markdown files are served from the Resources/ folder.</footer>

  <!-- Marked + DOMPurify from CDN to render markdown safely in-browser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
  <script>
    // Minimal client-side app to list and view proposal markdown files from Resources/
    const proposalsListEl = document.getElementById('proposals');
    const contentEl = document.getElementById('content');
    const currentTitleEl = document.getElementById('currentTitle');
    const downloadLinkEl = document.getElementById('downloadLink');
    const searchEl = document.getElementById('search');

    async function fetchJSON(path){
      const res = await fetch(path);
      if(!res.ok) throw new Error('Failed to load path:' + path);
      return res.json();
    }

    function renderMarkdown(md){
      // marked.parse -> HTML, DOMPurify to sanitize
      const html = DOMPurify.sanitize(marked.parse(md || ''));
      contentEl.innerHTML = html;
    }

    function makeListItem(item){
      const li = document.createElement('li');
      li.tabIndex = 0;
      li.setAttribute('role','button');
      li.innerHTML = `<strong>${escapeHtml(item.title)}</strong><div class="meta">${escapeHtml(item.date || '')} ${item.author? '• ' + escapeHtml(item.author): ''}</div>`;
      li.addEventListener('click', ()=> loadProposal(item));
      li.addEventListener('keypress', (e)=>{ if(e.key === 'Enter') loadProposal(item); });
      return li;
    }

    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[c])); }

    async function loadProposal(item){
      try{
        currentTitleEl.textContent = item.title || item.file;
        downloadLinkEl.href = 'Resources/' + item.file;
        downloadLinkEl.style.display = 'inline';
        downloadLinkEl.setAttribute('download', item.file);
        const mdRes = await fetch('Resources/' + item.file);
        if(!mdRes.ok) throw new Error('Failed to fetch proposal file');
        const md = await mdRes.text();
        renderMarkdown(md);
        // update hash for linking
        history.replaceState(null,'', '#' + encodeURIComponent(item.file));
      }catch(err){
        contentEl.innerHTML = `<p style="color:crimson">Error loading proposal: ${escapeHtml(err.message)}</p>`;
      }
    }

    async function init(){
      try{
        const data = await fetchJSON('Resources/proposals.json');
        window.__proposals = data.proposals || [];
        renderList(window.__proposals);
        // load from hash if present
        const hash = decodeURIComponent(location.hash.slice(1));
        if(hash){
          const found = window.__proposals.find(p=>p.file === hash);
          if(found) loadProposal(found);
        }
      }catch(err){
        proposalsListEl.innerHTML = `<li style="color:crimson">Failed to load proposals index: ${escapeHtml(err.message)}</li>`;
      }
    }

    function renderList(items){
      proposalsListEl.innerHTML = '';
      items.forEach(item=> proposalsListEl.appendChild(makeListItem(item)));
    }

    searchEl.addEventListener('input', ()=>{
      const q = searchEl.value.trim().toLowerCase();
      const filtered = window.__proposals.filter(p=> (p.title||'').toLowerCase().includes(q) || (p.author||'').toLowerCase().includes(q) || (p.summary||'').toLowerCase().includes(q) );
      renderList(filtered);
    });

    // init on page load
    window.addEventListener('load', init);
  </script>
</body>
</html>

